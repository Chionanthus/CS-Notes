### 用处

可用作注册中心，分布式锁





三台以上ZooKeeper机器可以组成集群，集群间通过 ZAB 协议（ZooKeeper Atomic Broadcast）来保持数据的一致性。



**最典型集群模式： Master/Slave 模式（主备模式）**。在这种模式中，通常 Master 服务器作为主服务器提供写服务，其他的 Slave 服务器从服务器通过异步复制的方式获取 Master 服务器最新的数据提供读服务。

但是ZooKeeper里面没有使用Master/Slave 概念，而是使用Leader、Follower 和 Observer 三种角色

集群里通过选举产生一台Leader，可读可写。Follower和Observer都只能提供读服务，区别在于Observer不参与Leader选举，且不参与写操作的“过半写成功”，可以在不影响写性能的情况下提升集群的读性能





ZooKeeper宕掉的机器如果超过了剩下的机器数，则ZooKeeper不可用

出于这种原理，ZooKeeper建议选奇数台，且不会出现脑裂





**分布式锁**

**zk在高并发的情况下保证节点创建的全局唯一性**

可以让多个客户端同时创建一个临时节点，**创建成功的就说明获取到了锁**，没有获取到锁的客户端创建一个watcher进行节点状态监听

共享锁和独占锁

这个时候我规定所有创建节点必须有序，当你是读请求（要获取共享锁）的话，如果 **没有比自己更小的节点，或比自己小的节点都是读请求** ，则可以获取到读锁，然后就可以开始读了。**若比自己小的节点中有写请求** ，则当前客户端无法获取到读锁，只能等待前面的写请求完成。

如果你是写请求（获取独占锁），若 **没有比自己更小的节点** ，则表示当前客户端可以直接获取到写锁，对数据进行修改。若发现 **有比自己更小的节点，无论是读操作还是写操作，当前客户端都无法获取到写锁** ，等待所有前面的操作完成。





**命名服务**

UUID太长，zk使用树形结构存储数据节点，对于每个节点的全路径，必定唯一，可以使用节点的全路径作为命名方式





**注册中心**

让服务提供者在zk中创建一个临时节点，把自己的IP、port、调用方式写入节点。服务消费者用过注册中心找到相应的服务的地址列表，并缓存到本地，可以添加watcher